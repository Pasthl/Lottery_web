<!-- index.ejs - æŠ½å¥–ç³»ç»Ÿä¸»é¡µ -->  

<!-- é¡µé¢æ ‡é¢˜éƒ¨åˆ† --> 
<div class="main-header">     
    <h1>è¿™æ˜¯ä¸€ä¸ªå¾ˆæ­£ç»çš„æŠ½å¥–ç½‘ç«™</h1>     
    <p class="subtitle">è¿™æ˜¯æŠ½å¥–ç½‘ç«™çš„ä¸»é¡µé¢</p> 
</div>  

<!-- æ´»åŠ¨ä¿¡æ¯éƒ¨åˆ† --> 
<section class="lottery-info">     
    <div class="card">         
        <h2>å½“å‰æŠ½å¥–æ´»åŠ¨</h2>         
        <% if (typeof currentLottery !== 'undefined' && currentLottery) { %>
            <!-- æ•°æ®åº“ä¸­çš„æŠ½å¥–æ´»åŠ¨ -->
            <div class="lottery-details">             
                <h3><%= currentLottery.title %></h3>             
                <p><%= currentLottery.description %></p>                          
                <!-- å€’è®¡æ—¶åŒºåŸŸ -->             
                <div class="countdown">                 
                    <h4>è·ç¦»å¼€å¥–è¿˜æœ‰ï¼š</h4>                 
                    <div class="timer" id="countdown-timer" data-end="<%= currentLottery.endTime.getTime() %>">                     
                        <span id="days">00</span>å¤©                     
                        <span id="hours">00</span>æ—¶                     
                        <span id="minutes">00</span>åˆ†                     
                        <span id="seconds">00</span>ç§’                 
                    </div>             
                </div>         
            </div>
        <% } else { %>
            <!-- å¦‚æœæ²¡æœ‰æŠ½å¥–æ´»åŠ¨ï¼Œæ˜¾ç¤ºé™æ€å†…å®¹ -->
            <div class="lottery-details">             
                <h3>æ¯”å¦‚è¿™æ˜¯ä¸€å¼ æœˆå¡</h3>             
                <p>ç”±æ²¦å®å§å§å‹æƒ…èµåŠ©</p>                          
                <!-- å€’è®¡æ—¶åŒºåŸŸ -->             
                <div class="countdown">                 
                    <h4>è·ç¦»å¼€å¥–è¿˜æœ‰ï¼š</h4>                 
                    <div class="timer" id="countdown-timer">                     
                        <span id="days">00</span>å¤©                     
                        <span id="hours">00</span>æ—¶                     
                        <span id="minutes">00</span>åˆ†                     
                        <span id="seconds">00</span>ç§’                 
                    </div>             
                </div>         
            </div>
        <% } %>
    </div> 
</section>  

<!-- ä¸Šä¸€æœŸä¸­å¥–åå•éƒ¨åˆ† --> 
<section class="winners-section">     
    <div class="card">         
        <h2>ä¸Šä¸€æœŸä¸­å¥–åå•</h2>         
        <% if (typeof winners !== 'undefined' && winners && winners.length > 0) { %>
            <!-- æ•°æ®åº“ä¸­çš„ä¸­å¥–è€… -->
            <ul class="winners-list">
                <% winners.forEach(function(winner) { %>
                    <li>                 
                        <span class="winner-id">ç”¨æˆ·ID: <%= winner.participantId || winner.userId %></span>                 
                        <span class="winner-date">æŠ½å¥–æ—¥æœŸ: <%= winner.drawnAt ? new Date(winner.drawnAt).toLocaleDateString() : (winner.reviewedAt ? new Date(winner.reviewedAt).toLocaleDateString() : 'æœªçŸ¥') %></span>             
                    </li>
                <% }); %>
            </ul>
        <% } else { %>
            <!-- é™æ€ç¤ºä¾‹æ•°æ® -->         
            <ul class="winners-list">             
                <li>                 
                    <span class="winner-id">ç”¨æˆ·ID: ç™½çŒ«è­¦å¸</span>                 
                    <span class="winner-date">æŠ½å¥–æ—¥æœŸ: 2025-02-14</span>             
                </li>             
                <li>                 
                    <span class="winner-id">ç”¨æˆ·ID: é»‘çŒ«è­¦ç£</span>                 
                    <span class="winner-date">æŠ½å¥–æ—¥æœŸ: 2025-02-14</span>             
                </li>         
            </ul>
        <% } %>
    </div> 
</section>  

<!-- å‚ä¸æŠ½å¥–è¡¨å•éƒ¨åˆ† --> 
<section class="entry-form">     
    <div class="card">         
        <h2>å‚ä¸æœ¬æœŸæŠ½å¥–</h2>         
        
        <% if (typeof currentLottery !== 'undefined' && currentLottery) { %>
            <!-- è¡¨å•æäº¤åˆ°/submitè·¯ç”± -->         
            <form id="lottery-form" action="/submit" method="post" enctype="multipart/form-data">             
                <!-- æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ -->
                <% if (typeof success !== 'undefined' && success === 'true') { %>
                    <div class="success-message">
                        æäº¤æˆåŠŸï¼æ‚¨çš„æŠ½å¥–æ¡ç›®å·²è®°å½•ï¼Œè¯·ç­‰å¾…å®¡æ ¸ã€‚
                    </div>
                <% } %>
                
                <!-- æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ -->
                <% if (typeof error !== 'undefined' && error) { %>
                    <div class="error-message">
                        <%= error %>
                    </div>
                <% } %>
                
                <!-- éšè—çš„æŠ½å¥–æ´»åŠ¨ID -->
                <input type="hidden" name="lottery" value="<%= currentLottery._id %>">
                
                <!-- å‚ä¸è€…IDè¾“å…¥æ¡† -->             
                <div class="form-group">                 
                    <label for="participant-id">è¯·è¾“å…¥ä½ çš„ç‡•äº‘id</label>                 
                    <input type="text" id="participant-id" name="participantId" required value="<%= typeof participantId !== 'undefined' ? participantId : '' %>">                 
                    <small>ä¸å‡†ä¹±è¾“ï¼Œè¿è€…å¤±å»å½“æ¬¡æŠ½å¥–èµ„æ ¼å¹¶å¥–åŠ±é›é›çš„ä¸€ä¸ªå¤§æ¯”æ–—</small>             
                </div>                          
                
                <!-- æˆªå›¾ä¸Šä¼  -->             
                <div class="form-group">                 
                    <label for="screenshot">ä¸Šä¼ æˆªå›¾ï¼š</label>                 
                    <input type="file" id="screenshot" name="screenshot" accept="image/*" required>                 
                    <small>ä¸Šä¼ ç™¾ä¸šæ´»è·ƒåº¦æˆªå›¾</small>             
                </div>                          
                
                <!-- æäº¤æŒ‰é’® -->             
                <button type="submit" class="btn">æäº¤å‚ä¸</button>         
            </form>
        <% } else { %>
            <!-- å¦‚æœæ²¡æœ‰è¿›è¡Œä¸­çš„æŠ½å¥–æ´»åŠ¨ -->
            <div class="no-lottery-message">
                <p>å½“å‰æ²¡æœ‰è¿›è¡Œä¸­çš„æŠ½å¥–æ´»åŠ¨ï¼Œè¯·ç¨åå†æ¥ï¼</p>
            </div>
        <% } %>
    </div> 
</section>  

<!-- ç®¡ç†å‘˜å…¥å£é“¾æ¥ --> 
<div class="admin-link">     
    <a href="/admin">è¿›å…¥ç®¡ç†å‘˜é¡µé¢</a> 
</div>  

<div class="easter-egg-link">     
    <a href="/easter-egg" title="ç‚¹å‡»æŸ¥çœ‹å½©è›‹">ğŸ¥š å‘ç°å½©è›‹!</a> 
</div>

<script>
// å€’è®¡æ—¶è„šæœ¬
document.addEventListener('DOMContentLoaded', function() {
    const countdownEl = document.getElementById('countdown-timer');
    
    // æ£€æŸ¥æ˜¯å¦æœ‰å€’è®¡æ—¶æ—¥æœŸ
    if (countdownEl && countdownEl.hasAttribute('data-end')) {
        const endTime = parseInt(countdownEl.getAttribute('data-end'));
        
        // æ›´æ–°å€’è®¡æ—¶
        function updateCountdown() {
            const now = new Date().getTime();
            const distance = endTime - now;
            
            // è®¡ç®—å¤©ã€æ—¶ã€åˆ†ã€ç§’
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('days').innerText = String(days).padStart(2, '0');
            document.getElementById('hours').innerText = String(hours).padStart(2, '0');
            document.getElementById('minutes').innerText = String(minutes).padStart(2, '0');
            document.getElementById('seconds').innerText = String(seconds).padStart(2, '0');
            
            // å¦‚æœå€’è®¡æ—¶ç»“æŸ
            if (distance < 0) {
                document.getElementById('days').innerText = '00';
                document.getElementById('hours').innerText = '00';
                document.getElementById('minutes').innerText = '00';
                document.getElementById('seconds').innerText = '00';
                
                // å¯é€‰ï¼šæ˜¾ç¤ºå·²ç»“æŸæ¶ˆæ¯
                const countdownDiv = document.querySelector('.countdown h4');
                if (countdownDiv) {
                    countdownDiv.textContent = "æŠ½å¥–å·²ç»“æŸ!";
                }
                
                clearInterval(countdownInterval);
            }
        }
        
        // ç«‹å³è¿è¡Œä¸€æ¬¡
        updateCountdown();
        
        // æ¯ç§’æ›´æ–°ä¸€æ¬¡
        const countdownInterval = setInterval(updateCountdown, 1000);
    }
});
</script>